<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>ğŸŒ¸ è–¬ãƒãƒ ğŸŒ¸</title>

<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-192.png">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#ff8fb1">

<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@500;700&display=swap" rel="stylesheet">

<style>

body{
font-family:'Zen Maru Gothic',sans-serif;
background:#fff5f7;
color:#5d5d5d;
margin:0;
padding:20px;
text-align:center;
}

.container{
max-width:400px;
margin:auto;
}

h1{
color:#ff8fb1;
}

.status{
color:#ff8fb1;
margin-bottom:10px;
font-weight:bold;
}

.card{
background:white;
padding:12px;
margin-bottom:12px;
border-radius:20px;
box-shadow:0 4px 10px rgba(255,143,177,0.2);
border:2px solid #ffe4e9;
}

.btn{
width:100%;
padding:18px;
border:none;
border-radius:15px;
font-size:18px;
font-weight:bold;
color:white;
}

.normal{
background:#87ceeb;
}

.done{
background:#e0e0e0;
}

.tonpuku{
background:#ff8fb1;
}

.disabled{
background:#f3d1d9;
}

.sub{
background:#ffb7c5;
margin-top:10px;
padding:10px;
font-size:14px;
}

.nav{
display:flex;
justify-content:space-between;
margin:10px;
}

.history-card{
background:white;
padding:10px;
margin-bottom:10px;
border-radius:15px;
text-align:left;
border-left:6px solid #ffb7c5;
}

</style>
</head>
<body>

<div id="main" class="container">

<h1>ğŸŒ¸ è–¬ãƒãƒ ğŸŒ¸</h1>

<div id="status" class="status"></div>

<div id="list"></div>

<button class="btn sub" onclick="showHistory()">ğŸ“… å±¥æ­´</button>

</div>


<div id="history" class="container" style="display:none;">

<h1>ğŸ“… å±¥æ­´</h1>

<div class="nav">

<button class="btn sub" onclick="prevPage()">â† æ–°ã—ã„</button>

<div id="pageLabel"></div>

<button class="btn sub" onclick="nextPage()">å¤ã„ â†’</button>

</div>

<div id="historyList"></div>

<button class="btn sub" onclick="showMain()">æˆ»ã‚‹</button>

</div>


<script>

const MEDICINES=["ã‚³ãƒ³ã‚µ1","ã‚³ãƒ³ã‚µ2","æŠ‘è‚æ•£","é “æœ"];

let page=0;

function getLogs(){
return JSON.parse(localStorage.getItem("yakumane_logs")||"[]");
}

function save(name){

const logs=getLogs();

logs.push({
name,
timestamp:Date.now()
});

localStorage.setItem("yakumane_logs",JSON.stringify(logs));

render();

}

function deleteRecent(name){

let logs=getLogs();

for(let i=logs.length-1;i>=0;i--){

if(logs[i].name===name){

logs.splice(i,1);
break;

}

}

localStorage.setItem("yakumane_logs",JSON.stringify(logs));

render();

}

function render(){

const logs=getLogs();

const today=new Date().toLocaleDateString();

const taken=logs
.filter(l=>new Date(l.timestamp).toLocaleDateString()==today)
.map(l=>l.name);

const allDone=["ã‚³ãƒ³ã‚µ1","ã‚³ãƒ³ã‚µ2","æŠ‘è‚æ•£"]
.every(m=>taken.includes(m));

document.getElementById("status").innerText=
allDone?"ğŸ’– å…¨å®Œäº†ï¼":"ãã‚‡ã†ã‚‚ ã¼ã¡ã¼ã¡ ã®ã‚‚ã†ã­";

const list=document.getElementById("list");

list.innerHTML="";

let canTonpuku=true;
let waitText="";

const ton=logs.filter(l=>l.name=="é “æœ");

if(ton.length){

const last=ton[ton.length-1].timestamp;

const diff=Date.now()-last;

if(diff<14400000){

canTonpuku=false;

const rem=14400000-diff;

const h=Math.floor(rem/3600000);
const m=Math.floor(rem%3600000/60000);

waitText=` (${h}h${m}m)`;

}

}

MEDICINES.forEach(m=>{

const card=document.createElement("div");
card.className="card";

const btn=document.createElement("button");

let cls="normal";

if(m!="é “æœ"&&taken.includes(m))cls="done";

if(m=="é “æœ")cls=canTonpuku?"tonpuku":"disabled";

btn.className="btn "+cls;

btn.innerText=m+(m=="é “æœ"?waitText:"");

btn.onclick=()=>{
if(m!="é “æœ"||canTonpuku)
save(m);
};

let timer;

btn.onmousedown=()=>timer=setTimeout(()=>deleteRecent(m),800);
btn.onmouseup=()=>clearTimeout(timer);

card.appendChild(btn);

list.appendChild(card);

});

}

function showHistory(){

document.getElementById("main").style.display="none";
document.getElementById("history").style.display="block";

renderHistory();

}

function showMain(){

document.getElementById("main").style.display="block";
document.getElementById("history").style.display="none";

}

function renderHistory(){

const logs=getLogs();

const list=document.getElementById("historyList");

list.innerHTML="";

const start=page*7;

const end=start+7;

document.getElementById("pageLabel").innerText=
(start+1)+"ã€œ"+end+"æ—¥å‰";

for(let i=start;i<end;i++){

const d=new Date();

d.setDate(d.getDate()-i);

const ds=d.toLocaleDateString();

const day=logs.filter(l=>
new Date(l.timestamp).toLocaleDateString()==ds
);

const div=document.createElement("div");

div.className="history-card";

div.innerHTML="<b>"+ds+"</b><br>";

day.forEach(l=>{
div.innerHTML+=
new Date(l.timestamp).toLocaleTimeString()+" "+l.name+"<br>";
});

list.appendChild(div);

}

}

function nextPage(){
page++;
renderHistory();
}

function prevPage(){
if(page>0){
page--;
renderHistory();
}
}

render();

setInterval(render,60000);

</script>

</body>
</html>
