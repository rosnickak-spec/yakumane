<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸŒ¸ è–¬ãƒãƒ ğŸŒ¸</title>

<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@500;700&display=swap" rel="stylesheet">

<style>

body{
font-family:'Zen Maru Gothic',sans-serif;
text-align:center;
background:#fff5f7;
margin:0;
padding:20px;
color:#5d5d5d;
}

.container{
max-width:400px;
margin:auto;
}

h1{
color:#ff8fb1;
}

.status-msg{
font-size:1.1rem;
color:#ffb7c5;
font-weight:bold;
margin-bottom:20px;
}

.card{
background:white;
padding:12px;
border-radius:20px;
box-shadow:0 8px 15px rgba(255,143,177,0.1);
margin-bottom:12px;
border:2px solid #ffe4e9;
}

.btn{
width:100%;
font-size:18px;
padding:18px;
color:white;
border:none;
border-radius:15px;
cursor:pointer;
font-weight:700;
margin-top:5px;
}

.btn:active{
transform:scale(0.98);
opacity:0.8;
}

.btn.sub{
background:#ffb7c5;
font-size:14px;
padding:10px;
}

.nav{
margin-top:20px;
display:flex;
gap:10px;
}

#history-page{
display:none;
}

.history-card{
background:white;
margin-bottom:15px;
padding:15px;
border-radius:20px;
text-align:left;
border-left:8px solid #ffb7c5;
}

</style>
</head>

<body>


<div id="main-page" class="container">

<h1>ğŸŒ¸ è–¬ãƒãƒ ğŸŒ¸</h1>

<div id="status-msg" class="status-msg">
èª­ã¿è¾¼ã¿ä¸­...
</div>

<div id="medicine-list"></div>

<button class="btn sub" onclick="showHistory(0)">
ğŸ“… å±¥æ­´ã‚’è¦‹ã‚‹
</button>

</div>



<div id="history-page" class="container">

<h1>ğŸ“… å±¥æ­´</h1>

<div id="history-list"></div>

<div class="nav">

<button id="newer-btn" class="btn sub">
â† æ–°ã—ã„
</button>

<button id="older-btn" class="btn sub">
å¤ã„ â†’
</button>

</div>

<button class="btn sub" onclick="showMain()">
ãƒ¡ã‚¤ãƒ³ã«ã‚‚ã©ã‚‹
</button>

</div>



<script>


const MEDICINES=["ã‚³ãƒ³ã‚µ1","ã‚³ãƒ³ã‚µ2","æŠ‘è‚æ•£","é “æœ"];

const DAYS_PER_PAGE=7;

let historyPage=0;



function getLogs(){

const data=localStorage.getItem("yakumane_logs");

return data?JSON.parse(data):[];

}



function saveLogs(logs){

localStorage.setItem("yakumane_logs",JSON.stringify(logs));

}



function saveLog(name){

const now=new Date();

const date=now.toLocaleDateString('ja-JP').replaceAll('-','/');

const time=now.toLocaleTimeString('ja-JP',{hour12:false});

const logs=getLogs();

logs.push({

name,

date,

time,

timestamp:now.getTime()

});

saveLogs(logs);

render();

}



function deleteRecent(name){

const today=new Date().toLocaleDateString('ja-JP').replaceAll('-','/');

let logs=getLogs();

const index=logs.findLastIndex(

l=>l.name===name && l.date===today

);

if(index!=-1){

if(confirm(name+" ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")){

logs.splice(index,1);

saveLogs(logs);

render();

}

}

}



function render(){

const logs=getLogs();

const today=new Date().toLocaleDateString('ja-JP').replaceAll('-','/');

const todayLogs=logs.filter(l=>l.date===today);

const taken=todayLogs.map(l=>l.name);



const allClear=MEDICINES.slice(0,3)

.every(m=>taken.includes(m));



document.getElementById("status-msg").innerHTML=

allClear

?"ğŸ’– å…¨å®Œäº†ï¼ ğŸ’–"

:"ãã‚‡ã†ã‚‚ ã¼ã¡ã¼ã¡ ã®ã‚‚ã†ã­";



let canTonpuku=true;

let waitText="";



const tLogs=logs.filter(l=>l.name==="é “æœ");

if(tLogs.length>0){

const last=tLogs[tLogs.length-1].timestamp;

const diff=Date.now()-last;

const wait=4*60*60*1000;

if(diff<wait){

canTonpuku=false;

const remain=wait-diff;

const h=Math.floor(remain/3600000);

const m=Math.floor((remain%3600000)/60000);

waitText=` (ã‚ã¨${h}h${m}m)`;

}

}



const list=document.getElementById("medicine-list");

list.innerHTML="";



MEDICINES.forEach(m=>{

const isTaken=(m!="é “æœ" && taken.includes(m));

let color="#87ceeb";

if(isTaken)color="#e0e0e0";

if(m=="é “æœ")color=canTonpuku?"#ff8fb1":"#f3d1d9";



const card=document.createElement("div");

card.className="card";



const btn=document.createElement("button");

btn.className="btn";

btn.style.background=color;

btn.innerText=m+

(isTaken?" (æ¸ˆ)":"")+

(m=="é “æœ"?waitText:"");



let timer;

btn.onmousedown=btn.ontouchstart=()=>{

timer=setTimeout(()=>deleteRecent(m),800);

};

btn.onmouseup=btn.ontouchend=()=>clearTimeout(timer);



btn.onclick=()=>{

if(!isTaken && (m!="é “æœ"||canTonpuku)){

saveLog(m);

}

};



card.appendChild(btn);

list.appendChild(card);

});

}



function showHistory(page){

historyPage=page;

document.getElementById("main-page").style.display="none";

document.getElementById("history-page").style.display="block";



const logs=getLogs();

const list=document.getElementById("history-list");

list.innerHTML="";



const dates=[...new Set(logs.map(l=>l.date))].reverse();



const start=page*DAYS_PER_PAGE;

const end=start+DAYS_PER_PAGE;

const pageDates=dates.slice(start,end);



pageDates.forEach(date=>{

const dayLogs=logs.filter(l=>l.date==date);

let html=

`<div class="history-card">

<b style="color:#ff8fb1">${date}</b>`;



dayLogs.forEach(l=>{

html+=`<div>ãƒ»${l.time} ${l.name}</div>`;

});



html+="</div>";

list.innerHTML+=html;

});



document.getElementById("newer-btn").style.display=

page>0?"block":"none";



document.getElementById("older-btn").style.display=

end<dates.length?"block":"none";



document.getElementById("newer-btn").onclick=

()=>showHistory(page-1);



document.getElementById("older-btn").onclick=

()=>showHistory(page+1);

}



function showMain(){

document.getElementById("main-page").style.display="block";

document.getElementById("history-page").style.display="none";

}



render();

setInterval(render,60000);


</script>

</body>
</html>
